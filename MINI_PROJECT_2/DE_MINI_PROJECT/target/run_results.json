{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.9.2", "generated_at": "2025-03-14T14:08:15.172388Z", "invocation_id": "d9349a0c-1320-4ce2-b780-ad71f905a757", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-03-14T14:08:12.199310Z", "completed_at": "2025-03-14T14:08:12.211013Z"}, {"name": "execute", "started_at": "2025-03-14T14:08:12.211013Z", "completed_at": "2025-03-14T14:08:14.203990Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.004680633544922, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01bb00f0-3201-7db6-000c-3d5a00026416"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.DE_MINI_PROJECT.kpi3", "compiled": true, "compiled_code": "WITH BASE AS (\n    SELECT\n        t.CUSTOMER_ID,\n        c.CUSTOMER_NAME, -- Join with stg_customers to get CUSTOMER_NAME\n        t.PAYMENT_DATE,\n        DATEADD(month, -3, t.PAYMENT_DATE) AS PREVIOUS_MONTH,\n        COUNT(DISTINCT t.PRODUCT_ID) AS NO_OF_PRODUCTS,\n        SUM(t.revenue) AS TOTAL_REVENUE -- Replace TOTAL_REVENUE with revenue or appropriate calculation\n    FROM DE_MINI_PROJECT.staging.stg_transactions t\n    JOIN DE_MINI_PROJECT.staging.stg_customers c -- Join with stg_customers\n        ON t.CUSTOMER_ID = c.CUSTOMER_ID\n    GROUP BY\n        t.CUSTOMER_ID,\n        c.CUSTOMER_NAME,\n        t.PAYMENT_DATE\n), BASE2 AS (\n    SELECT\n        CUSTOMER_ID,\n        PAYMENT_DATE,\n        COUNT(PRODUCT_ID) AS NO_OF_PRODUCTS,\n        SUM(revenue) AS TOTAL_REVENUE -- Replace TOTAL_REVENUE with revenue or appropriate calculation\n    FROM DE_MINI_PROJECT.staging.stg_transactions\n    GROUP BY\n        CUSTOMER_ID,\n        PAYMENT_DATE\n), max_payment_month AS (\n    SELECT\n        MAX(PAYMENT_DATE) AS max_payment_month\n    FROM DE_MINI_PROJECT.staging.stg_transactions\n), product_churn AS (\n    SELECT\n        c.CUSTOMER_NAME,\n        COUNT(DISTINCT CASE WHEN t.PAYMENT_DATE < DATEADD(MONTH, -3, max_payment_month) THEN t.PRODUCT_ID END) AS Product_Churn\n    FROM DE_MINI_PROJECT.staging.stg_transactions t\n    JOIN DE_MINI_PROJECT.staging.stg_customers c -- Join with stg_customers\n        ON t.CUSTOMER_ID = c.CUSTOMER_ID\n    JOIN max_payment_month ON 1=1\n    GROUP BY\n        c.CUSTOMER_NAME\n), FINAL AS (\n    SELECT\n        BASE.CUSTOMER_NAME,\n        BASE.CUSTOMER_ID,\n        BASE.PAYMENT_DATE,\n        BASE.NO_OF_PRODUCTS,\n        BASE.TOTAL_REVENUE,\n        BASE.PREVIOUS_MONTH,\n        BASE2.TOTAL_REVENUE AS PREVIOUS_MONTH_REVENUE,\n        BASE2.NO_OF_PRODUCTS AS NO_OF_PRODUCTS_PAST_MONTH,\n        Product_Churn\n    FROM BASE\n    LEFT JOIN BASE2\n        ON BASE.CUSTOMER_ID = BASE2.CUSTOMER_ID\n        AND BASE.PREVIOUS_MONTH = BASE2.PAYMENT_DATE\n    LEFT JOIN product_churn\n        ON BASE.CUSTOMER_NAME = product_churn.CUSTOMER_NAME\n), FINAL2 AS (\n    SELECT\n        CUSTOMER_ID,\n        CUSTOMER_NAME,\n        PAYMENT_DATE,\n        NO_OF_PRODUCTS,\n        TOTAL_REVENUE,\n        PREVIOUS_MONTH,\n        PREVIOUS_MONTH_REVENUE,\n        NO_OF_PRODUCTS_PAST_MONTH,\n        CASE\n            WHEN (NO_OF_PRODUCTS - (NO_OF_PRODUCTS_PAST_MONTH - Product_Churn)) > 0 THEN (NO_OF_PRODUCTS - (NO_OF_PRODUCTS_PAST_MONTH - Product_Churn))\n            ELSE 0\n        END AS CROSS_SELL_IN_PRODUCTS,\n        CASE\n            WHEN (NO_OF_PRODUCTS - (NO_OF_PRODUCTS_PAST_MONTH - Product_Churn)) > 0 THEN (TOTAL_REVENUE - PREVIOUS_MONTH_REVENUE)\n            ELSE 0\n        END AS CROSS_SELL_IN_REVENUE,\n        Product_Churn AS PRODUCT_CHURN\n    FROM FINAL\n), FINAL3 AS (\n    SELECT\n        *,\n        RANK() OVER (ORDER BY CROSS_SELL_IN_REVENUE DESC) AS CROSS_SELL_RANK,\n        RANK() OVER (ORDER BY PRODUCT_CHURN DESC) AS PRODUCT_CHURN_RANK\n    FROM FINAL2\n)\nSELECT\n    *\nFROM\n    FINAL3\nORDER BY CROSS_SELL_RANK, PRODUCT_CHURN_RANK", "relation_name": "DE_MINI_PROJECT.mart.kpi3", "batch_results": null}], "elapsed_time": 6.113212823867798, "args": {"cache_selected_only": false, "profiles_dir": "C:\\Users\\BurelaSuryaPrathap\\.dbt", "project_dir": "C:\\Users\\BurelaSuryaPrathap\\MINI_PROJECT_2\\DE_MINI_PROJECT", "print": true, "source_freshness_run_project_hooks": false, "version_check": true, "favor_state": false, "require_resource_names_without_spaces": false, "select": ["kpi3"], "skip_nodes_if_on_run_start_fails": false, "state_modified_compare_vars": false, "require_yaml_configuration_for_mf_time_spines": false, "partial_parse": true, "require_batched_execution_for_custom_microbatch_strategy": false, "partial_parse_file_diff": true, "log_format": "default", "exclude": [], "empty": false, "log_level_file": "debug", "populate_cache": true, "send_anonymous_usage_stats": true, "which": "run", "require_nested_cumulative_type_params": false, "invocation_command": "dbt run -m kpi3", "strict_mode": false, "use_colors_file": true, "introspect": true, "defer": false, "warn_error_options": {"include": [], "exclude": []}, "log_file_max_bytes": 10485760, "macro_debugging": false, "printer_width": 80, "log_format_file": "debug", "quiet": false, "require_explicit_package_overrides_for_builtin_materializations": true, "log_level": "info", "indirect_selection": "eager", "show_resource_report": false, "vars": {}, "log_path": "C:\\Users\\BurelaSuryaPrathap\\MINI_PROJECT_2\\DE_MINI_PROJECT\\logs", "state_modified_compare_more_unrendered_values": false, "use_colors": true, "write_json": true, "static_parser": true}}